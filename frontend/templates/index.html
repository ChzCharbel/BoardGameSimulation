<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-Agent Fire Rescue Simulation</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container-fluid mt-3">
      <div class="row">
        <div class="col-12">
          <h1 class="text-center mb-2">
            <i class="fas fa-microchip text-primary"></i>
            Multi-Agent Fire Rescue Simulation
            <i class="fas fa-fire text-danger"></i>
          </h1>
          <p class="text-center text-muted mb-4">
            A Python implementation using Mesa Framework for Agent-Based
            Modeling
          </p>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-8 mx-auto">
          <div class="card shadow mb-4">
            <div class="card-header bg-dark text-white">
              <h4 class="mb-0">
                <i class="fas fa-code"></i> Technical Overview
              </h4>
            </div>
            <div class="card-body">
              <p class="lead">
                This simulation demonstrates a
                <strong>Multi-Agent System (MAS)</strong> where autonomous
                firefighter agents coordinate to rescue victims in a burning
                building. Built with Python and Mesa framework, it showcases
                emergent behavior through agent interactions.
              </p>

              <div class="row mt-4">
                <div class="col-md-6 mb-3">
                  <div class="tech-feature">
                    <i class="fas fa-robot fa-2x text-primary mb-2"></i>
                    <h6>Autonomous Agents</h6>
                    <p class="small">
                      6 firefighter agents with individual decision-making
                      capabilities and role assignment
                    </p>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="tech-feature">
                    <i class="fas fa-network-wired fa-2x text-success mb-2"></i>
                    <h6>Emergent Behavior</h6>
                    <p class="small">
                      Complex coordination patterns emerge from simple agent
                      interaction rules
                    </p>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="tech-feature">
                    <i class="fas fa-brain fa-2x text-warning mb-2"></i>
                    <h6>Intelligent Pathfinding</h6>
                    <p class="small">
                      Dijkstra algorithm for optimal navigation through walls,
                      doors, and fire-affected cells
                    </p>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="tech-feature">
                    <i class="fas fa-exchange-alt fa-2x text-info mb-2"></i>
                    <h6>Dynamic Role Assignment</h6>
                    <p class="small">
                      Agents adapt roles (Rescuer/Extinguisher) based on
                      environmental conditions
                    </p>
                  </div>
                </div>
              </div>

              <div class="text-center mt-4">
                <button
                  id="create-simulation"
                  class="btn btn-primary btn-lg me-3"
                >
                  <i class="fas fa-play"></i> Launch Simulation
                </button>
                <a
                  href="#implementation"
                  class="btn btn-outline-secondary btn-lg"
                  data-bs-toggle="collapse"
                >
                  <i class="fas fa-code-branch"></i> View Implementation
                </a>
              </div>
            </div>
          </div>

          <!-- Implementation Details -->
          <div class="collapse" id="implementation">
            <div class="card shadow mb-4">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  <i class="fas fa-cogs"></i> System Architecture
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h6>
                      <i class="fas fa-layer-group text-primary"></i> Core
                      Components
                    </h6>
                    <ul class="list-unstyled">
                      <li>
                        <strong>FireRescueModel:</strong> Mesa Model managing 8×6 grid, fire states, and game logic
                      </li>
                      <li>
                        <strong>FireAgent:</strong> 6 autonomous agents with role-based behaviors
                      </li>
                      <li>
                        <strong>MultiGrid:</strong> Spatial environment allowing multiple agents per cell
                      </li>
                      <li>
                        <strong>POI System:</strong> 10 victims + 5 false alarms with reveal mechanics
                      </li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <h6>
                      <i class="fas fa-brain text-success"></i> Agent
                      Intelligence
                    </h6>
                    <ul class="list-unstyled">
                      <li>
                        <strong>Role Assignment:</strong> Dynamic RESCUER/EXTINGUISHER switching
                      </li>
                      <li>
                        <strong>Pathfinding:</strong> Dijkstra algorithm for optimal navigation
                      </li>
                      <li>
                        <strong>Fire Handling:</strong> Extinguish while moving to targets
                      </li>
                      <li>
                        <strong>Knockout System:</strong> 2-turn recovery when caught in fire
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow mb-4">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                  <i class="fas fa-code"></i> Agent Behavior Implementation
                </h5>
              </div>
              <div class="card-body">
                <p>
                  Each firefighter agent implements sophisticated behavior
                  patterns using the Mesa framework:
                </p>
                <pre><code class="language-python">class FireAgent(Agent):
    def __init__(self, unique_id, model):
        super().__init__(model)
        self.action_points = 4
        self.role = None  # RESCUER or EXTINGUISHER
        self.target_poi = None
        self.carrying_victim = None
        self.knockout_timer = 0
        self.max_knockout_time = 2
        self.path = []
        
    def step(self):
        self.reset_ap()  # Reset to 4 action points
        self.update_knockout()
        
        if self.is_knocked_out():
            return  # Skip turn if unconscious
            
        if self.role == FireFighterRole.RESCUER:
            self.rescuer_behavior()
        elif self.role == FireFighterRole.EXTINGUISHER:
            self.extinguisher_behavior()
            
        self.check_knockout()  # Check if in fire
            
    def rescuer_behavior(self):
        if self.carrying_victim:
            # Navigate to nearest exit and rescue
            target_exit = self.get_nearest_exit([(0, 2), (7, 4)])
            self.move_with_fire_handling(target_exit)
        elif self.target_poi:
            # Move to POI, reveal, and pick up victim
            self.move_with_fire_handling((self.target_poi.x, self.target_poi.y))
            
    def extinguisher_behavior(self):
        while self.action_points > 0:
            target = self.find_nearest_fire()
            if target:
                if self.pos == target:
                    self.extinguish_fire(target[0], target[1])
                else:
                    self.move_towards_target(target)
                    
    def djikstra(self, start, goal):
        # Dijkstra pathfinding implementation
        # Returns optimal path considering walls and doors
        ...</code></pre>
              </div>
            </div>

            <div class="card shadow mb-4">
              <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                  <i class="fas fa-chart-line"></i> Emergent Properties
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-4">
                    <div class="emergent-property text-center p-3">
                      <i class="fas fa-users-cog fa-3x text-primary mb-2"></i>
                      <h6>Self-Organization</h6>
                      <p class="small">
                        Agents form rescue teams based on proximity to POIs without central coordination
                      </p>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="emergent-property text-center p-3">
                      <i
                        class="fas fa-balance-scale fa-3x text-success mb-2"
                      ></i>
                      <h6>Dynamic Role Balancing</h6>
                      <p class="small">
                        Max 3 rescuers assigned; remaining agents become extinguishers automatically
                      </p>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="emergent-property text-center p-3">
                      <i class="fas fa-route fa-3x text-warning mb-2"></i>
                      <h6>Adaptive Pathfinding</h6>
                      <p class="small">
                        Agents recalculate paths dynamically as fire spreads and walls are destroyed
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="card shadow mb-4">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                  <i class="fas fa-flask"></i> Simulation Parameters
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h6>Environment</h6>
                    <ul class="list-unstyled">
                      <li><code>Grid Size:</code> 8×6 cells with walls & doors</li>
                      <li><code>Fire States:</code> CLEAR → SMOKE → FIRE</li>
                      <li><code>Structural Damage:</code> Max 24 before collapse</li>
                      <li>
                        <code>POIs:</code> 10 victims + 5 false alarms
                      </li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <h6>Agent Parameters</h6>
                    <ul class="list-unstyled">
                      <li><code>Agents:</code> 6 firefighters</li>
                      <li><code>Action Points:</code> 4 per turn</li>
                      <li><code>Knockout Duration:</code> 2 turns in fire</li>
                      <li>
                        <code>Win Condition:</code> Rescue 7 victims
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-12">
                    <h6>Action Costs</h6>
                    <ul class="list-inline">
                      <li class="list-inline-item"><code>Move:</code> 1 AP</li>
                      <li class="list-inline-item"><code>Open Door:</code> 1 AP</li>
                      <li class="list-inline-item"><code>Extinguish Smoke:</code> 1 AP</li>
                      <li class="list-inline-item"><code>Extinguish Fire:</code> 2 AP</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
