<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fire Rescue - Multi-Agent Simulation</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container-fluid">
      <!-- Header -->
      <div class="row bg-dark text-white py-2">
        <div class="col-md-3">
          <h4><i class="fas fa-microchip text-primary"></i> Multi-Agent Fire Rescue</h4>
        </div>
        <div class="col-md-6">
          <div class="simulation-controls text-center">
            <button id="step-btn" class="btn btn-outline-light btn-sm me-2">
              <i class="fas fa-step-forward"></i> Step
            </button>
            <button id="auto-btn" class="btn btn-outline-success btn-sm me-2">
              <i class="fas fa-play"></i> Auto
            </button>
            <button id="stop-btn" class="btn btn-outline-warning btn-sm me-2">
              <i class="fas fa-pause"></i> Stop
            </button>
            <button id="reset-btn" class="btn btn-outline-danger btn-sm">
              <i class="fas fa-redo"></i> Reset
            </button>
          </div>
        </div>
        <div class="col-md-3 text-end">
          <a href="/" class="btn btn-outline-light btn-sm">
            <i class="fas fa-home"></i> Home
          </a>
        </div>
      </div>

      <!-- Main Content -->
      <div class="row mt-3">
        <!-- Game Board -->
        <div class="col-md-8">
          <div class="card">
            <div class="card-header">
              <h5>
                Simulation Grid - Round <span id="round-count">0</span> -
                <span id="current-phase">Initializing...</span>
              </h5>
            </div>
            <div class="card-body">
              <div id="game-board" class="game-board"></div>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
          <!-- Game Status -->
          <div class="card mb-3">
            <div class="card-header">
              <h6><i class="fas fa-chart-line"></i> Simulation Status</h6>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-6">
                  <div class="stat-box bg-success text-white">
                    <div class="stat-number" id="rescued-count">0</div>
                    <div class="stat-label">Rescued</div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="stat-box bg-danger text-white">
                    <div class="stat-number" id="lost-count">0</div>
                    <div class="stat-label">Lost</div>
                  </div>
                </div>
              </div>
              <div class="row text-center mt-2">
                <div class="col-6">
                  <div class="stat-box bg-warning text-dark">
                    <div class="stat-number" id="damage-count">0</div>
                    <div class="stat-label">Damage</div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="stat-box bg-info text-white">
                    <div class="stat-number" id="step-count">0</div>
                    <div class="stat-label">Steps</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Fire Stats -->
          <div class="card mb-3">
            <div class="card-header">
              <h6><i class="fas fa-fire"></i> Environmental Status</h6>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-4">
                  <div class="fire-stat bg-danger text-white">
                    <div class="stat-number" id="fire-count">0</div>
                    <div class="stat-label">Fire</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="fire-stat bg-secondary text-white">
                    <div class="stat-number" id="smoke-count">0</div>
                    <div class="stat-label">Smoke</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="fire-stat bg-success text-white">
                    <div class="stat-number" id="clear-count">0</div>
                    <div class="stat-label">Clear</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Agents Info -->
          <div class="card mb-3">
            <div class="card-header">
              <h6><i class="fas fa-robot"></i> Agent Status</h6>
            </div>
            <div class="card-body">
              <div id="agents-list"></div>
            </div>
          </div>

          <!-- POIs Info -->
          <div class="card">
            <div class="card-header">
              <h6><i class="fas fa-map-pin"></i> Points of Interest</h6>
            </div>
            <div class="card-body">
              <div id="pois-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal fade" id="gameOverModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="gameOverTitle">Simulation Complete</h4>
          </div>
          <div class="modal-body text-center">
            <div id="gameOverIcon" class="mb-3"></div>
            <h5 id="gameOverReason">Result</h5>
            <div id="gameOverStats" class="mt-3"></div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary" id="newGameBtn">
              New Simulation
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/simulation.js') }}"></script>
    <script>
      // Pass simulation_id from backend if it exists
      const urlParams = new URLSearchParams(window.location.search);
      if (!urlParams.get("id")) {
        // If no ID in URL, create new simulation automatically
        window.addEventListener("load", function () {
          setTimeout(function () {
            if (!simulationId) {
              createNewSimulation();
            }
          }, 100);
        });
      }
    </script>
  </body>
</html>
